import{i as le,r as I,s as ae,z as te,ay as re,au as ie,L as D,o as ne,I as L,A as V,bX as ue,V as de,H as h,bY as T,w as ce,b as me,u as pe,e as U,f as c,g as a,h as r,l as t,j as g,k as v,n as k,aq as _e,_ as S,t as u,q as n,az as N,ai as E,F as be,x as fe,p as w,bc as ge,bZ as ve,b_ as ye,b9 as Ce,aJ as Ve}from"./index--jEUqk-V.js";import{_ as he}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BxWQxK9R.js";import{_ as ke}from"./CourseOutline-B0Y7q8fs.js";import{_ as we}from"./MultiSelect-JcjvAitx.js";import"./vuedraggable.umd-Bu5X8fId.js";const xe={class:"h-full"},Ue={class:"grid md:grid-cols-[70%,30%] h-full"},Se={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"flex items-center mt-3 md:mt-0"},Ee={class:"mt-5 mb-5"},Pe={class:"px-10 pb-5 mb-5 space-y-5 border-b"},$e={class:"text-lg font-semibold mb-4"},Me={class:"grid grid-cols-2 gap-5"},Ie={class:"grid grid-cols-2 gap-5"},De={class:"mb-1.5 text-xs text-ink-gray-5"},Le={class:"flex items-center"},Te={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md mr-2"},Fe={class:"grid grid-cols-2 gap-5"},Oe={class:"mb-4"},je={class:"text-xs text-ink-gray-5 mb-2"},Ae={class:"flex items-center"},Re={class:"border rounded-md w-fit py-5 px-20"},qe={class:"ml-4"},Be={class:"mt-1 text-ink-gray-5 text-sm leading-5"},Ke={key:1,class:"mb-4"},ze={class:"flex items-center"},Xe=["src"],He={class:"ml-4"},Je={class:"mt-2 text-ink-gray-5 text-sm"},Ye={class:"px-10 pb-5 mb-5 space-y-5 border-b"},Ze={class:"text-lg font-semibold"},Ge={class:"grid grid-cols-2 gap-5"},Qe={class:"flex flex-col space-y-5"},We={class:"flex flex-col space-y-5"},es={class:"px-10 pb-5 mb-5 space-y-5 border-b"},ss={class:""},os={class:"mb-1.5 text-sm text-ink-gray-5"},ls={class:"px-10 pb-5 space-y-5 border-b"},as={class:"text-lg font-semibold mt-5"},ts={class:"grid grid-cols-3"},rs={class:"grid grid-cols-2 gap-5"},is={class:"space-y-5"},ns={class:"px-10 pb-5 space-y-5"},us={class:"text-lg font-semibold mt-5"},ds={class:"space-y-5"},cs={class:"border-l"},vs={__name:"CourseForm",props:{courseName:{type:String}},setup(F){const y=le("$user"),_=I(""),{brand:O}=ae(),x=te(),b=I([]),j=ie(),{updateOnboardingStep:A}=re("learning"),{$dialog:R}=j.appContext.config.globalProperties,m=F,o=D({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,paid_certificate:!1,course_price:"",currency:"",evaluator:""}),f=D({description:"",keywords:""});ne(()=>{var e,s;!((e=y.data)!=null&&e.is_moderator)&&!((s=y.data)!=null&&s.is_instructor)&&x.push({name:"Courses"}),m.courseName!=="new"?P():L("course_form_opened"),window.addEventListener("keydown",$)});const P=()=>{p.reload(),ue("courses",m.courseName,f)},$=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(M(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",$)});const q=V({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"LMS Course",image:((s=o.course_image)==null?void 0:s.file_url)||"",instructors:b.value.map(i=>({instructor:i})),...e}}}}),B=V({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:{image:((s=o.course_image)==null?void 0:s.file_url)||"",instructors:b.value.map(i=>({instructor:i})),...o}}}}),p=V({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:m.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(i=>{i=="instructors"?(b.value=[],e.instructors.forEach(d=>{b.value.push(d.instructor)})):Object.hasOwn(o,i)&&(o[i]=e[i])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification","paid_certificate"];for(let i in s){let d=s[i];o[d]=!!o[d]}e.image&&K.reload({image:e.image}),ee()}}),K=V({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){o.course_image=e}}),M=()=>{p.data?X():z()},z=()=>{q.submit(o,{onSuccess(e){var s;T("courses",e.name,f),(s=y.data)!=null&&s.is_system_manager&&A("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",e.name)}),L("course_created"),h.success(__("Course created successfully")),x.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;h.error(((s=e.messages)==null?void 0:s[0])||e)}})},X=()=>{B.submit({course:p.data.name},{onSuccess(){T("courses",m.courseName,f),h.success(__("Course updated successfully"))},onError(e){var s;h.error(((s=e.messages)==null?void 0:s[0])||e)}})},H=V({url:"lms.lms.api.delete_course",makeParams(e){return{course:m.courseName}},onSuccess(){h.success(__("Course deleted successfully")),x.push({name:"Courses"})}}),J=()=>{R({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){H.submit(),e()}}]})};ce(()=>m.courseName!=="new",e=>{e&&P()});const Y=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},Z=()=>{_.value&&(o.tags=o.tags?`${o.tags}, ${_.value}`:_.value,_.value="")},G=e=>{var s;o.tags=(s=o.tags)==null?void 0:s.split(", ").filter(i=>i!==e).join(", "),_.value=""},Q=e=>{o.course_image=e},W=()=>{o.course_image=null},ee=()=>{var s;let e=!1;(s=y.data)!=null&&s.is_moderator||(b.value.forEach(i=>{var d;!e&&i==((d=y.data)==null?void 0:d.name)&&(e=!0)}),e||x.push({name:"Courses"}))},se=me(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return p.data&&e.push({label:o.title,route:{name:"CourseDetail",params:{courseName:m.courseName}}}),e.push({label:m.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:m.courseName}}}),e});return pe(()=>{var e;return{title:((e=p.data)==null?void 0:e.title)||__("New Course"),icon:O.favicon}}),(e,s)=>{var i,d;return c(),U("div",xe,[a("div",Ue,[a("div",null,[a("header",Se,[r(t(he),{class:"h-7",items:se.value},null,8,["items"]),a("div",Ne,[(i=t(p).data)!=null&&i.name?(c(),g(t(S),{key:0,onClick:s[0]||(s[0]=l=>J())},{icon:k(()=>[r(t(_e),{class:"w-4 h-4 stroke-1.5"})]),_:1})):v("",!0),r(t(S),{variant:"solid",onClick:s[1]||(s[1]=l=>M()),class:"ml-2"},{default:k(()=>[a("span",null,u(e.__("Save")),1)]),_:1})])]),a("div",Ee,[a("div",Pe,[a("div",$e,u(e.__("Details")),1),a("div",Me,[r(t(n),{modelValue:o.title,"onUpdate:modelValue":s[2]||(s[2]=l=>o.title=l),label:e.__("Title"),required:!0},null,8,["modelValue","label"]),r(E,{doctype:"LMS Category",modelValue:o.category,"onUpdate:modelValue":s[3]||(s[3]=l=>o.category=l),label:e.__("Category"),onCreate:(l,C)=>t(N)("Categories",C)},null,8,["modelValue","label","onCreate"])]),a("div",Ie,[r(we,{modelValue:b.value,"onUpdate:modelValue":s[4]||(s[4]=l=>b.value=l),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},onCreate:l=>t(N)("Members",l),required:!0},null,8,["modelValue","label","onCreate"]),a("div",null,[a("div",De,u(e.__("Tags")),1),a("div",Le,[o.tags?(c(!0),U(be,{key:0},fe((d=o.tags)==null?void 0:d.split(", "),l=>(c(),U("div",Te,[w(u(l)+" ",1),r(t(ge),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:C=>G(l)},null,8,["onClick"])]))),256)):v("",!0),r(t(n),{modelValue:_.value,"onUpdate:modelValue":s[5]||(s[5]=l=>_.value=l),placeholder:e.__("Add a keyword and then press enter"),class:"w-full",onKeyup:s[6]||(s[6]=ve(l=>Z(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"])])])]),a("div",Fe,[r(t(n),{modelValue:o.short_introduction,"onUpdate:modelValue":s[7]||(s[7]=l=>o.short_introduction=l),type:"textarea",rows:5,label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),required:!0},null,8,["modelValue","label","placeholder"]),a("div",Oe,[a("div",je,[w(u(e.__("Course Image"))+" ",1),s[25]||(s[25]=a("span",{class:"text-ink-red-3"},"*",-1))]),o.course_image?(c(),U("div",Ke,[a("div",ze,[a("img",{src:o.course_image.file_url,class:"border rounded-md w-40"},null,8,Xe),a("div",He,[r(t(S),{onClick:s[9]||(s[9]=l=>W())},{default:k(()=>[w(u(e.__("Remove")),1)]),_:1}),a("div",Je,u(e.__("Appears on the course card in the course list")),1)])])])):(c(),g(t(Ce),{key:0,fileTypes:["image/*"],validateFile:Y,onSuccess:s[8]||(s[8]=l=>Q(l))},{default:k(({file:l,progress:C,uploading:ms,openFileSelector:oe})=>[a("div",Ae,[a("div",Re,[r(t(ye),{class:"size-5 stroke-1 text-ink-gray-7"})]),a("div",qe,[r(t(S),{onClick:oe},{default:k(()=>[w(u(e.__("Upload")),1)]),_:2},1032,["onClick"]),a("div",Be,u(e.__("Appears on the course card in the course list")),1)])])]),_:1}))])])]),a("div",Ye,[a("div",Ze,u(e.__("Settings")),1),a("div",Ge,[a("div",Qe,[r(t(n),{type:"checkbox",modelValue:o.published,"onUpdate:modelValue":s[10]||(s[10]=l=>o.published=l),label:e.__("Published")},null,8,["modelValue","label"]),r(t(n),{modelValue:o.published_on,"onUpdate:modelValue":s[11]||(s[11]=l=>o.published_on=l),label:e.__("Published On"),type:"date"},null,8,["modelValue","label"])]),a("div",We,[r(t(n),{type:"checkbox",modelValue:o.upcoming,"onUpdate:modelValue":s[12]||(s[12]=l=>o.upcoming=l),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(n),{type:"checkbox",modelValue:o.featured,"onUpdate:modelValue":s[13]||(s[13]=l=>o.featured=l),label:e.__("Featured")},null,8,["modelValue","label"]),r(t(n),{type:"checkbox",modelValue:o.disable_self_learning,"onUpdate:modelValue":s[14]||(s[14]=l=>o.disable_self_learning=l),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])])])]),a("div",es,[a("div",ss,[a("div",os,[w(u(e.__("Course Description"))+" ",1),s[26]||(s[26]=a("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Ve),{content:o.description,onChange:s[15]||(s[15]=l=>o.description=l),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(t(n),{modelValue:o.video_link,"onUpdate:modelValue":s[16]||(s[16]=l=>o.video_link=l),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course")},null,8,["modelValue","label","placeholder"])]),a("div",ls,[a("div",as,u(e.__("Pricing and Certification")),1),a("div",ts,[r(t(n),{type:"checkbox",modelValue:o.paid_course,"onUpdate:modelValue":s[17]||(s[17]=l=>o.paid_course=l),label:e.__("Paid Course")},null,8,["modelValue","label"]),r(t(n),{type:"checkbox",modelValue:o.enable_certification,"onUpdate:modelValue":s[18]||(s[18]=l=>o.enable_certification=l),label:e.__("Completion Certificate")},null,8,["modelValue","label"]),r(t(n),{type:"checkbox",modelValue:o.paid_certificate,"onUpdate:modelValue":s[19]||(s[19]=l=>o.paid_certificate=l),label:e.__("Paid Certificate")},null,8,["modelValue","label"])]),a("div",rs,[a("div",is,[o.paid_course||o.paid_certificate?(c(),g(t(n),{key:0,modelValue:o.course_price,"onUpdate:modelValue":s[20]||(s[20]=l=>o.course_price=l),label:e.__("Amount")},null,8,["modelValue","label"])):v("",!0),o.paid_certificate?(c(),g(E,{key:1,doctype:"Course Evaluator",modelValue:o.evaluator,"onUpdate:modelValue":s[21]||(s[21]=l=>o.evaluator=l),label:e.__("Evaluator"),onCreate:(l,C)=>t(N)("Evaluators",C)},null,8,["modelValue","label","onCreate"])):v("",!0)]),o.paid_course||o.paid_certificate?(c(),g(E,{key:0,doctype:"Currency",modelValue:o.currency,"onUpdate:modelValue":s[22]||(s[22]=l=>o.currency=l),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])):v("",!0)])]),a("div",ns,[a("div",us,u(e.__("Meta Tags")),1),a("div",ds,[r(t(n),{modelValue:f.description,"onUpdate:modelValue":s[23]||(s[23]=l=>f.description=l),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),r(t(n),{modelValue:f.keywords,"onUpdate:modelValue":s[24]||(s[24]=l=>f.keywords=l),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])]),a("div",cs,[t(p).data?(c(),g(ke,{key:0,courseName:t(p).data.name,title:e.__("Course Outline"),allowEdit:!0},null,8,["courseName","title"])):v("",!0)])])])}}};export{vs as default};
//# sourceMappingURL=CourseForm-CIGdwhIw.js.map
