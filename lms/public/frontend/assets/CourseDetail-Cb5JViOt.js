import{z as F,i as T,b as U,A as N,d as I,e as u,f as o,k as _,g as a,t as l,l as e,j as b,h as i,n as p,_ as x,p as S,B as A,C as B,D as H,U as D,E as W,S as E,G as O,H as C,a as Y,I as J,J as K,K as L,L as Q,q as X,M as Z,r as ee,F as R,x as V,N as P,s as te,u as se,O as j}from"./index--jEUqk-V.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BxWQxK9R.js";import{_ as re}from"./CertificationLinks-B-G5L8u6.js";import{_ as oe}from"./CourseOutline-B0Y7q8fs.js";import{_ as G}from"./UserAvatar-CWIXgT1I.js";import{_ as ne}from"./Rating.vue_vue_type_script_setup_true_lang-BIss1HRZ.js";import{_ as le}from"./CourseInstructors-irEVZDC3.js";import"./vuedraggable.umd-Bu5X8fId.js";const ie={class:"border-2 rounded-md min-w-80"},ue=["src"],ce={class:"p-5"},de={key:0,class:"text-2xl font-semibold mb-3"},me={key:1},_e={key:0,class:"space-y-2"},fe={class:"space-y-4"},pe={class:"flex items-center text-ink-gray-9"},ve={class:"ml-2"},he={class:"flex items-center text-ink-gray-9"},ge={class:"ml-2"},we={key:0,class:"flex items-center text-ink-gray-9"},ye={class:"ml-2"},be={key:1,class:"flex items-center font-semibold text-ink-gray-9"},ke={class:"ml-2"},$e={key:2,class:"flex items-center font-semibold text-ink-gray-9"},xe={class:"ml-2"},q={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(r){const $=F(),f=T("$user"),t=window.read_only_mode,n=r,m=U(()=>n.course.data.video_link?"https://www.youtube.com/embed/"+n.course.data.video_link:null);function k(){f.data?Y("lms.lms.doctype.lms_enrollment.lms_enrollment.create_membership",{course:n.course.data.name}).then(()=>{J("enrolled_in_course",{course:n.course.data.name}),C.success(__("You have been enrolled in this course")),setTimeout(()=>{$.push({name:"Lesson",params:{courseName:n.course.data.name,chapterNumber:1,lessonNumber:1}})},1e3)}).catch(s=>{var c;C.warning(__(((c=s.messages)==null?void 0:c[0])||s)),console.error(s)}):(C.success(__("You need to login first to enroll for this course")),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},500))}const g=()=>{let s=!1;return n.course.data.instructors.forEach(c=>{var y;!s&&c.name==((y=f.data)==null?void 0:y.name)&&(s=!0)}),s},w=U(()=>{var s,c,y;return!!((s=n.course.data)!=null&&s.enable_certification&&((y=(c=n.course.data)==null?void 0:c.membership)==null?void 0:y.progress)==100)}),h=N({url:"lms.lms.doctype.lms_certificate.lms_certificate.create_certificate",makeParams(s){return{course:s.course}},onSuccess(s){window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${s.name}&format=${encodeURIComponent(s.template)}`,"_blank")}}),v=()=>{var s,c;h.submit({course:(s=n.course.data)==null?void 0:s.name,member:(c=f.data)==null?void 0:c.name})};return(s,c)=>{var d,M;const y=I("router-link");return o(),u("div",ie,[r.course.data.video_link?(o(),u("iframe",{key:0,src:m.value,class:"rounded-t-md min-h-56 w-full"},null,8,ue)):_("",!0),a("div",ce,[r.course.data.paid_course?(o(),u("div",de,l(r.course.data.price),1)):_("",!0),e(t)?_("",!0):(o(),u("div",me,[r.course.data.membership?(o(),u("div",_e,[i(y,{to:{name:"Lesson",params:{courseName:r.course.name,chapterNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[0]:1,lessonNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[1]:1}}},{default:p(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:p(()=>[a("span",null,l(s.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"]),i(re,{courseName:r.course.data.name,class:"w-full"},null,8,["courseName"])])):r.course.data.paid_course?(o(),b(y,{key:1,to:{name:"Billing",params:{type:"course",name:r.course.data.name}}},{default:p(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:p(()=>[a("span",null,l(s.__("Buy this course")),1)]),_:1})]),_:1},8,["to"])):r.course.data.disable_self_learning?(o(),b(e(A),{key:2,theme:"blue",size:"lg"},{default:p(()=>[S(l(s.__("Contact the Administrator to enroll for this course.")),1)]),_:1})):(o(),b(e(x),{key:3,onClick:c[0]||(c[0]=z=>k()),variant:"solid",class:"w-full",size:"md"},{default:p(()=>[a("span",null,l(s.__("Start Learning")),1)]),_:1})),w.value?(o(),b(e(x),{key:4,onClick:c[1]||(c[1]=z=>v()),variant:"subtle",class:"w-full mt-2",size:"md"},{default:p(()=>[S(l(s.__("Get Certificate")),1)]),_:1})):_("",!0),(M=(d=e(f))==null?void 0:d.data)!=null&&M.is_moderator||g()?(o(),b(y,{key:5,to:{name:"CourseForm",params:{courseName:r.course.data.name}}},{default:p(()=>[i(e(x),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:p(()=>[a("span",null,l(s.__("Edit")),1)]),_:1})]),_:1},8,["to"])):_("",!0)])),a("div",fe,[a("div",{class:B(["font-medium text-ink-gray-9",{"mt-8":!e(t)}])},l(s.__("This course has:")),3),a("div",pe,[i(e(H),{class:"h-4 w-4 stroke-1.5"}),a("span",ve,l(r.course.data.lessons)+" "+l(s.__("Lessons")),1)]),a("div",he,[i(e(D),{class:"h-4 w-4 stroke-1.5"}),a("span",ge,l(e(W)(r.course.data.enrollments))+" "+l(s.__("Enrolled Students")),1)]),parseInt(r.course.data.rating)>0?(o(),u("div",we,[i(e(E),{class:"size-4 stroke-1.5 fill-yellow-500 text-transparent"}),a("span",ye,l(r.course.data.rating)+" "+l(s.__("Rating")),1)])):_("",!0),r.course.data.enable_certification?(o(),u("div",be,[i(e(O),{class:"h-4 w-4 stroke-2"}),a("span",ke,l(s.__("Certificate of Completion")),1)])):_("",!0),r.course.data.paid_certificate?(o(),u("div",$e,[i(e(O),{class:"h-4 w-4 stroke-2"}),a("span",xe,l(s.__("Paid Certificate after Evaluation")),1)])):_("",!0)])])])}}},Re={class:"flex flex-col gap-4"},Ne={__name:"ReviewModal",props:K({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadReviews:{},reloadReviewsModifiers:{},hasReviewed:{},hasReviewedModifiers:{}}),emits:["update:modelValue","update:reloadReviews","update:hasReviewed"],setup(r){const $=L(r,"modelValue"),f=L(r,"reloadReviews"),t=L(r,"hasReviewed");let n=Q({review:"",rating:0});const m=r,k=N({url:"frappe.client.insert",makeParams(w){return{doc:{doctype:"LMS Course Review",course:m.courseName,...w}}}});function g(w){n.rating=n.rating/5,k.submit(n,{validate(){if(!n.rating)return"Please enter a rating."},onSuccess(){f.value.reload(),t.value.reload()},onError(h){var v;C.error(((v=h.messages)==null?void 0:v[0])||h)}}),w()}return(w,h)=>(o(),b(e(Z),{modelValue:$.value,"onUpdate:modelValue":h[2]||(h[2]=v=>$.value=v),options:{title:w.__("Write a Review"),size:"xl",actions:[{label:"Submit",variant:"solid",onClick:v=>g(v)}]}},{"body-content":p(()=>[a("div",Re,[i(e(ne),{modelValue:e(n).rating,"onUpdate:modelValue":h[0]||(h[0]=v=>e(n).rating=v),label:w.__("Rating")},null,8,["modelValue","label"]),i(e(X),{label:w.__("Review"),type:"textarea",modelValue:e(n).review,"onUpdate:modelValue":h[1]||(h[1]=v=>e(n).review=v),rows:5},null,8,["label","modelValue"])])]),_:1},8,["modelValue","options"]))}},Ce={key:0,class:"mt-20 mb-10"},Se={class:"flex items-center font-semibold text-2xl text-ink-gray-9"},Ve={class:"grid gap-8 mt-10"},Me={class:"flex items-center"},ze={class:"mx-4"},Le={class:"text-lg font-medium mr-4 text-ink-gray-7"},Ue={class:"text-ink-gray-7"},Be={class:"flex mt-2 space-x-1"},Ee={key:0,class:"mt-4 leading-5 text-ink-gray-7"},Oe={__name:"CourseReviews",props:{courseName:{type:String,required:!0},avg_rating:{type:String,required:!0},membership:{type:Object,required:!1}},setup(r){var g,w,h;const $=T("$user"),f=r,t=N({url:"frappe.client.get_count",cache:["eligible_to_review",f.courseName,(g=f.membership)==null?void 0:g.member],params:{doctype:"LMS Course Review",filters:{course:f.courseName,owner:(w=f.membership)==null?void 0:w.member}},auto:!!((h=$.data)!=null&&h.name)}),n=N({url:"lms.lms.utils.get_reviews",cache:["course_reviews",f.courseName],params:{course:f.courseName},auto:!0}),m=ee(!1);function k(){m.value=!0}return(v,s)=>{var y;const c=I("router-link");return o(),u(R,null,[(y=e(n).data)!=null&&y.length||r.membership?(o(),u("div",Ce,[r.membership&&!e(t).data?(o(),b(e(x),{key:0,onClick:s[0]||(s[0]=d=>k()),class:"float-right"},{default:p(()=>[S(l(v.__("Write a Review")),1)]),_:1})):_("",!0),a("div",Se,l(v.__("Student Reviews")),1),a("div",Ve,[(o(!0),u(R,null,V(e(n).data,(d,M)=>(o(),u("div",null,[a("div",Me,[i(c,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:p(()=>[i(G,{user:d.owner_details,size:"2xl"},null,8,["user"])]),_:2},1032,["to"]),a("div",ze,[i(c,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:p(()=>[a("span",Le,l(d.owner_details.full_name),1)]),_:2},1032,["to"]),a("span",Ue,l(d.creation),1),a("div",Be,[(o(),u(R,null,V(5,z=>i(e(E),{class:B(["size-4 text-transparent rounded-sm",z<=Math.ceil(d.rating)?"fill-yellow-500":"fill-gray-300"])},null,8,["class"])),64))])])]),d.review?(o(),u("div",Ee,l(d.review),1)):_("",!0)]))),256))])])):_("",!0),i(Ne,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=d=>m.value=d),reloadReviews:e(n),"onUpdate:reloadReviews":s[2]||(s[2]=d=>P(n)?n.value=d:null),hasReviewed:e(t),"onUpdate:hasReviewed":s[3]||(s[3]=d=>P(t)?t.value=d:null),courseName:r.courseName},null,8,["modelValue","reloadReviews","hasReviewed","courseName"])],64)}}},Pe={key:0},je={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},qe={class:"m-5"},Te={class:"flex justify-between w-full"},Ie={class:"md:w-2/3"},Ae={class:"text-3xl font-semibold text-ink-gray-9"},De={class:"my-3 leading-6 text-ink-gray-7"},Ge={class:"flex items-center"},Fe={class:"ml-1 text-ink-gray-7"},He={key:1,class:"mx-3"},We={class:"ml-1"},Ye={key:3,class:"mx-3"},Je={class:"flex items-center"},Ke={key:0,class:"flex my-4 w-fit"},Qe=["innerHTML"],Xe={class:"mt-10"},Ze={class:"hidden md:block"},it={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(r){const{brand:$}=te(),f=r,t=N({url:"lms.lms.utils.get_course_details",cache:["course",f.courseName],params:{course:f.courseName},auto:!0}),n=U(()=>{var k,g;let m=[{label:"Courses",route:{name:"Courses"}}];return m.push({label:(k=t==null?void 0:t.data)==null?void 0:k.title,route:{name:"CourseDetail",params:{courseName:(g=t==null?void 0:t.data)==null?void 0:g.name}}}),m});return se(()=>{var m;return{title:(m=t==null?void 0:t.data)==null?void 0:m.title,icon:$.favicon}}),(m,k)=>e(t).data?(o(),u("div",Pe,[a("header",je,[i(e(ae),{class:"h-7",items:n.value},null,8,["items"])]),a("div",qe,[a("div",Te,[a("div",Ie,[a("div",Ae,l(e(t).data.title),1),a("div",De,l(e(t).data.short_introduction),1),a("div",Ge,[parseInt(e(t).data.rating)>0?(o(),b(e(j),{key:0,text:m.__("Average Rating"),class:"flex items-center"},{default:p(()=>[i(e(E),{class:"size-4 text-transparent fill-yellow-500"}),a("span",Fe,l(e(t).data.rating),1)]),_:1},8,["text"])):_("",!0),parseInt(e(t).data.rating)>0?(o(),u("span",He,"·")):_("",!0),e(t).data.enrollment_count?(o(),b(e(j),{key:2,text:m.__("Enrolled Students"),class:"flex items-center"},{default:p(()=>[i(e(D),{class:"h-4 w-4 text-ink-gray-7"}),a("span",We,l(e(t).data.enrollment_count_formatted),1)]),_:1},8,["text"])):_("",!0),e(t).data.enrollment_count?(o(),u("span",Ye,"·")):_("",!0),a("div",Je,[a("span",{class:B(["h-6 mr-1",{"avatar-group overlap":e(t).data.instructors.length>1}])},[(o(!0),u(R,null,V(e(t).data.instructors,g=>(o(),b(G,{user:g},null,8,["user"]))),256))],2),i(le,{instructors:e(t).data.instructors},null,8,["instructors"])])]),e(t).data.tags?(o(),u("div",Ke,[(o(!0),u(R,null,V(e(t).data.tags.split(", "),g=>(o(),b(e(A),{theme:"gray",size:"lg",class:"mr-2 text-ink-gray-9"},{default:p(()=>[S(l(g),1)]),_:2},1024))),256))])):_("",!0),i(q,{course:e(t),class:"md:hidden mb-4"},null,8,["course"]),a("div",{innerHTML:e(t).data.description,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-10"},null,8,Qe),a("div",Xe,[i(oe,{title:m.__("Course Outline"),courseName:e(t).data.name,showOutline:!0},null,8,["title","courseName"])]),i(Oe,{courseName:e(t).data.name,avg_rating:e(t).data.rating,membership:e(t).data.membership},null,8,["courseName","avg_rating","membership"])]),a("div",Ze,[i(q,{course:e(t)},null,8,["course"])])])])])):_("",!0)}};export{it as default};
//# sourceMappingURL=CourseDetail-Cb5JViOt.js.map
