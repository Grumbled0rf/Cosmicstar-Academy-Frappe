import{J as N,i as k,K as P,L as A,A as V,w as U,j as D,f as r,n as u,g as s,e as m,k as y,h as o,t as n,l as t,v as T,q as z,F as S,x as B,C as F,aa as Y,M as L,H as R,r as q,au as G,b as H,p as E,_ as M,aY as J,aZ as I,a_ as K,a$ as Z,b0 as O,b1 as Q,b2 as W,aF as X,a9 as ee,G as te,b3 as ae,N as se,a as le}from"./index--jEUqk-V.js";const oe={class:"flex flex-col gap-4"},ne={class:"mb-1.5 text-sm text-ink-gray-5"},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={key:0},ce={class:"mb-1.5 text-sm text-ink-gray-5"},de={class:"grid grid-cols-2 gap-2"},ue=["onClick"],me={key:1,class:"text-sm italic text-ink-red-4"},_e={__name:"EvaluationModal",props:N({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(v){const b=k("$user"),_=k("$dayjs"),h=P(v,"modelValue"),x=P(v,"reloadEvals"),p=v,a=A({course:"",date:"",start_time:"",end_time:"",day:"",batch:p.batch,member:b.data.name}),f=V({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Certificate Request",batch_name:e.batch,...e}}}});function C(e){f.submit(a,{validate(){if(!a.course)return"Please select a course.";if(!a.date)return"Please select a date.";if(!a.start_time)return"Please select a slot.";if(_(a.date).isBefore(_(),"day"))return"Please select a future date.";if(_(a.date).isAfter(_(p.endDate),"day"))return`Please select a date before the end date ${_(p.endDate).format("DD MMMM YYYY")}.`},onSuccess(){x.value.reload(),e()},onError(l){var c;R.warning(__(((c=l.messages)==null?void 0:c[0])||l))}})}const $=()=>{const e=[];for(const l of p.courses)l.evaluator&&e.push({label:l.title,value:l.course});return e.length===1&&(a.course=e[0].value),e},g=V({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(e){return{course:e.course,date:e.date,batch:p.batch}}});U(()=>a.date,e=>{a.start_time="",e&&a.course&&g.submit(a)}),U(()=>a.course,e=>{a.date="",a.start_time="",g.reset()});const w=e=>{a.start_time=e.start_time,a.end_time=e.end_time,a.day=e.day};return(e,l)=>(r(),D(t(L),{modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=c=>h.value=c),options:{title:e.__("Schedule Evaluation"),size:"xl",actions:[{label:e.__("Submit"),variant:"solid",onClick:c=>C(c)}]}},{"body-content":u(()=>{var c;return[s("div",oe,[s("div",null,[s("div",ne,n(e.__("Course")),1),o(t(T),{modelValue:a.course,"onUpdate:modelValue":l[0]||(l[0]=d=>a.course=d),options:$()},null,8,["modelValue","options"])]),s("div",null,[s("div",ie,n(e.__("Date")),1),o(t(z),{type:"date",modelValue:a.date,"onUpdate:modelValue":l[1]||(l[1]=d=>a.date=d),min:t(_)().add(t(_).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),(c=t(g).data)!=null&&c.length?(r(),m("div",re,[s("div",ce,n(e.__("Select a slot")),1),s("div",de,[(r(!0),m(S,null,B(t(g).data,d=>(r(),m("div",null,[s("div",{class:F(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":a.start_time==d.start_time}]),onClick:i=>w(d)},n(t(Y)(d.start_time))+" - "+n(t(Y)(d.end_time)),11,ue)]))),256))])])):a.course&&a.date?(r(),m("div",me,n(e.__("No slots available for this date.")),1)):y("",!0)])]}),_:1},8,["modelValue","options"]))}},fe={class:"flex items-center justify-between mb-4"},ve={class:"text-lg text-ink-gray-9 font-semibold"},pe={key:0},he={class:"grid grid-cols-3 gap-4"},ge={class:"border text-ink-gray-7 rounded-md p-3"},be={class:"flex justify-between mb-3"},ye={class:"font-semibold text-ink-gray-9 leading-5"},ke={class:"flex items-center mb-2"},xe={class:"ml-2"},Ce={class:"flex items-center mb-2"},$e={class:"ml-2"},we={class:"flex items-center"},Ee={class:"ml-2"},Me={key:0,class:"flex items-center justify-between space-x-2 mt-4"},Ve={key:1,class:"text-sm italic text-ink-gray-5"},Ye={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(v){const b=k("$dayjs"),_=k("$user"),h=q(!1),x=G(),{$dialog:p}=x.appContext.config.globalProperties,a=v,f=V({url:"lms.lms.utils.get_upcoming_evals",params:{student:_.data.name,courses:a.courses.map(e=>e.course),batch:a.batch},auto:!0});function C(){h.value=!0}const $=e=>{window.open(e.google_meet_link,"_blank")},g=H(()=>a.courses.filter(e=>e.evaluator!="")),w=e=>{p({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(l){le("lms.lms.api.cancel_evaluation",{evaluation:e}).then(()=>{f.reload()}),l()}}]})};return(e,l)=>{var c,d;return r(),m(S,null,[s("div",null,[s("div",fe,[s("div",ve,n(e.__("Upcoming Evaluations")),1),((c=t(f).data)==null?void 0:c.length)!=g.value.length?(r(),D(t(M),{key:0,onClick:C},{default:u(()=>[E(n(e.__("Schedule Evaluation")),1)]),_:1})):y("",!0)]),(d=t(f).data)!=null&&d.length?(r(),m("div",pe,[s("div",he,[(r(!0),m(S,null,B(t(f).data,i=>(r(),m("div",null,[s("div",ge,[s("div",be,[s("span",ye,n(i.course_title),1),i.date>t(b)().format()?(r(),D(t(W),{key:0,as:"div",class:"relative inline-block text-left"},{default:u(()=>[s("div",null,[o(t(J),{class:"inline-flex w-full justify-center"},{default:u(()=>[o(t(I),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),o(K,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:u(()=>[o(t(Z),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:u(()=>[o(t(O),null,{default:u(({active:j})=>[o(t(M),{variant:"ghost",class:"w-full",onClick:De=>w(i)},{prefix:u(()=>[o(t(Q),{active:j,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:u(()=>[E(" "+n(e.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):y("",!0)]),s("div",ke,[o(t(X),{class:"w-4 h-4 stroke-1.5"}),s("span",xe,n(t(b)(i.date).format("DD MMMM YYYY")),1)]),s("div",Ce,[o(t(ee),{class:"w-4 h-4 stroke-1.5"}),s("span",$e,n(t(Y)(i.start_time)),1)]),s("div",we,[o(t(te),{class:"w-4 h-4 stroke-1.5"}),s("span",Ee,n(i.evaluator_name),1)]),i.google_meet_link?(r(),m("div",Me,[o(t(M),{onClick:j=>$(i),class:"w-full"},{prefix:u(()=>[o(t(ae),{class:"w-4 h-4 stroke-1.5"})]),default:u(()=>[E(" "+n(e.__("Join Call")),1)]),_:2},1032,["onClick"])])):y("",!0)])]))),256))])])):(r(),m("div",Ve,n(e.__("Please schedule an evaluation to get certified.")),1))]),o(_e,{batch:v.batch,endDate:v.endDate,courses:v.courses,modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=i=>h.value=i),reloadEvals:t(f),"onUpdate:reloadEvals":l[1]||(l[1]=i=>se(f)?f.value=i:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{Ye as _};
//# sourceMappingURL=UpcomingEvaluations-BW2yXJS5.js.map
